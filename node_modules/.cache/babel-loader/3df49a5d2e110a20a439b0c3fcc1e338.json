{"remainingRequest":"/Users/wujian/2019项目/demo/countdown/node_modules/babel-loader/lib/index.js!/Users/wujian/2019项目/demo/countdown/node_modules/@vue/cli-plugin-eslint/node_modules/eslint-loader/index.js??ref--13-0!/Users/wujian/2019项目/demo/countdown/src/utils/http.js","dependencies":[{"path":"/Users/wujian/2019项目/demo/countdown/src/utils/http.js","mtime":1564995460157},{"path":"/Users/wujian/2019项目/demo/countdown/node_modules/cache-loader/dist/cjs.js","mtime":1564995541627},{"path":"/Users/wujian/2019项目/demo/countdown/node_modules/babel-loader/lib/index.js","mtime":1564995537574},{"path":"/Users/wujian/2019项目/demo/countdown/node_modules/@vue/cli-plugin-eslint/node_modules/eslint-loader/index.js","mtime":1564995540604}],"contextDependencies":[],"result":["import \"core-js/modules/es6.string.iterator\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/web.dom.iterable\";\n\nfunction request(url, params, type) {\n  var newUrl = url;\n  var options = {\n    method: type,\n    headers: {\n      'content-type': 'application/json'\n    }\n  };\n\n  if (type === 'post' || type === 'put' || type === 'delete') {\n    options = Object.assign(options, {\n      body: JSON.stringify(params)\n    });\n  }\n\n  if (type === 'get') {\n    var queryStr = '';\n\n    if (params) {\n      queryStr = '?';\n      Object.keys(params).forEach(function (key) {\n        queryStr += \"\".concat(key, \"=\").concat(params[key], \"&\");\n      });\n      newUrl = (newUrl + queryStr).slice(0, (newUrl + queryStr).length - 1);\n    }\n  } // fetch本身不支持设置请求超时时间\n  // 通过Promise.race()比较两个Promise谁先改变状态来达到请求超时的效果\n\n\n  return Promise.race([window.fetch(newUrl, options).then(function (res) {\n    if (res.ok) {\n      return res;\n    }\n\n    return Promise.reject(\"\".concat(res.status, \"(\").concat(res.statusText, \")\")); // eslint-disable-line\n  }).catch(function (error) {\n    return Promise.reject(String(error));\n  }), new Promise(function (resolve, reject) {\n    setTimeout(function () {\n      reject('请求超时');\n    }, 20000);\n  })]).then(function (response) {\n    return response.json();\n  }).then(function (data) {\n    return data;\n  }).catch(function (error) {\n    return Promise.reject(error);\n  });\n}\n\nvar methods = ['get', 'post', 'put', 'delete'];\nvar Fetch = {};\nmethods.forEach(function (n) {\n  Fetch[n] = function (url, params) {\n    return request(url, params, n);\n  };\n});\nexport default Fetch;",{"version":3,"sources":["/Users/wujian/2019项目/demo/countdown/src/utils/http.js"],"names":["request","url","params","type","newUrl","options","method","headers","Object","assign","body","JSON","stringify","queryStr","keys","forEach","key","slice","length","Promise","race","window","fetch","then","res","ok","reject","status","statusText","catch","error","String","resolve","setTimeout","response","json","data","methods","Fetch","n"],"mappings":";;;;AAAA,SAASA,OAAT,CAAiBC,GAAjB,EAAsBC,MAAtB,EAA8BC,IAA9B,EAAoC;AAClC,MAAIC,MAAM,GAAGH,GAAb;AACA,MAAII,OAAO,GAAG;AACZC,IAAAA,MAAM,EAAEH,IADI;AAEZI,IAAAA,OAAO,EAAE;AACP,sBAAgB;AADT;AAFG,GAAd;;AAMA,MAAIJ,IAAI,KAAK,MAAT,IAAmBA,IAAI,KAAK,KAA5B,IAAqCA,IAAI,KAAK,QAAlD,EAA4D;AAC1DE,IAAAA,OAAO,GAAGG,MAAM,CAACC,MAAP,CAAcJ,OAAd,EAAuB;AAC/BK,MAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAeV,MAAf;AADyB,KAAvB,CAAV;AAGD;;AACD,MAAIC,IAAI,KAAK,KAAb,EAAoB;AAClB,QAAIU,QAAQ,GAAG,EAAf;;AACA,QAAIX,MAAJ,EAAY;AACVW,MAAAA,QAAQ,GAAG,GAAX;AACAL,MAAAA,MAAM,CAACM,IAAP,CAAYZ,MAAZ,EAAoBa,OAApB,CAA4B,UAACC,GAAD,EAAS;AACnCH,QAAAA,QAAQ,cAAOG,GAAP,cAAcd,MAAM,CAACc,GAAD,CAApB,MAAR;AACD,OAFD;AAGAZ,MAAAA,MAAM,GAAG,CAACA,MAAM,GAAGS,QAAV,EAAoBI,KAApB,CAA0B,CAA1B,EAA6B,CAACb,MAAM,GAAGS,QAAV,EAAoBK,MAApB,GAA6B,CAA1D,CAAT;AACD;AACF,GAtBiC,CAwBlC;AACA;;;AACA,SAAOC,OAAO,CAACC,IAAR,CAAa,CAClBC,MAAM,CAACC,KAAP,CAAalB,MAAb,EAAqBC,OAArB,EAA8BkB,IAA9B,CAAmC,UAACC,GAAD,EAAS;AAC1C,QAAIA,GAAG,CAACC,EAAR,EAAY;AACV,aAAOD,GAAP;AACD;;AACD,WAAOL,OAAO,CAACO,MAAR,WAAkBF,GAAG,CAACG,MAAtB,cAAgCH,GAAG,CAACI,UAApC,OAAP,CAJ0C,CAIiB;AAC5D,GALD,EAKGC,KALH,CAKS,UAAAC,KAAK;AAAA,WAAIX,OAAO,CAACO,MAAR,CAAeK,MAAM,CAACD,KAAD,CAArB,CAAJ;AAAA,GALd,CADkB,EAOlB,IAAIX,OAAJ,CAAa,UAACa,OAAD,EAAUN,MAAV,EAAqB;AAChCO,IAAAA,UAAU,CAAC,YAAM;AACfP,MAAAA,MAAM,CAAC,MAAD,CAAN;AACD,KAFS,EAEP,KAFO,CAAV;AAGD,GAJD,CAPkB,CAAb,EAYJH,IAZI,CAYC,UAAAW,QAAQ;AAAA,WAAIA,QAAQ,CAACC,IAAT,EAAJ;AAAA,GAZT,EAaJZ,IAbI,CAaC,UAACa,IAAD,EAAU;AACd,WAAOA,IAAP;AACD,GAfI,EAeFP,KAfE,CAeI,UAACC,KAAD,EAAW;AAClB,WAAOX,OAAO,CAACO,MAAR,CAAeI,KAAf,CAAP;AACD,GAjBI,CAAP;AAkBD;;AAED,IAAMO,OAAO,GAAG,CAAC,KAAD,EAAQ,MAAR,EAAgB,KAAhB,EAAuB,QAAvB,CAAhB;AACA,IAAMC,KAAK,GAAG,EAAd;AACAD,OAAO,CAACtB,OAAR,CAAgB,UAACwB,CAAD,EAAO;AACrBD,EAAAA,KAAK,CAACC,CAAD,CAAL,GAAW,UAACtC,GAAD,EAAMC,MAAN;AAAA,WAAiBF,OAAO,CAACC,GAAD,EAAMC,MAAN,EAAcqC,CAAd,CAAxB;AAAA,GAAX;AACD,CAFD;AAIA,eAAeD,KAAf","sourcesContent":["function request(url, params, type) {\n  let newUrl = url;\n  let options = {\n    method: type,\n    headers: {\n      'content-type': 'application/json',\n    },\n  };\n  if (type === 'post' || type === 'put' || type === 'delete') {\n    options = Object.assign(options, {\n      body: JSON.stringify(params),\n    });\n  }\n  if (type === 'get') {\n    let queryStr = '';\n    if (params) {\n      queryStr = '?';\n      Object.keys(params).forEach((key) => {\n        queryStr += `${key}=${params[key]}&`;\n      });\n      newUrl = (newUrl + queryStr).slice(0, (newUrl + queryStr).length - 1);\n    }\n  }\n\n  // fetch本身不支持设置请求超时时间\n  // 通过Promise.race()比较两个Promise谁先改变状态来达到请求超时的效果\n  return Promise.race([\n    window.fetch(newUrl, options).then((res) => {\n      if (res.ok) {\n        return res;\n      }\n      return Promise.reject(`${res.status}(${res.statusText})`); // eslint-disable-line\n    }).catch(error => Promise.reject(String(error))),\n    new Promise(((resolve, reject) => {\n      setTimeout(() => {\n        reject('请求超时');\n      }, 20000);\n    }))])\n    .then(response => response.json())\n    .then((data) => {\n      return data;\n    }).catch((error) => {\n      return Promise.reject(error);\n    });\n}\n\nconst methods = ['get', 'post', 'put', 'delete'];\nconst Fetch = {};\nmethods.forEach((n) => {\n  Fetch[n] = (url, params) => request(url, params, n);\n});\n\nexport default Fetch;\n"]}]}